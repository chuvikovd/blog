<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,400,700|Roboto+Slab&display=swap" rel=stylesheet> <link href=apple-touch-icon.png rel=apple-touch-icon sizes=180x180> <link href=favicon-32x32.png rel=icon sizes=32x32 type=image/png> <link href=favicon-16x16.png rel=icon sizes=16x16 type=image/png> <link href=site.webmanifest rel=manifest> <link href=client/main.1434789384.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>React-Static using node.api.js with 3rd party plugins | chuva.dev</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156495800-1"></script><script>window.dataLayer = window.dataLayer || []
    function gtag() {
      dataLayer.push(arguments)
    }
    gtag('js', new Date())

    gtag('config', 'UA-156495800-1') </script><meta content="How to work with node.api.js file inside React-Static while using third party plugins that modify webpack loaders" name=description><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <main class=min-h-screen><div class="flex flex-wrap container m-auto max-w-5xl pb-8 px-4 relative"><div class="flex absolute active after:-z-1 after:absolute after:bg-cyan after:empty-content after:h-6 after:w-6 cursor-pointer p-5 right-0 top-0 transition-mode z-10"><svg class="mr-2 w-8" viewBox="0 0 24 24"><path class=fill-yellow d="M17 12c0 2.762-2.238 5-5 5s-5-2.238-5-5 2.238-5 5-5 5 2.238 5
      5zm-5-7c.34 0 .672.033 1 .08v-2.08h-2v2.08c.328-.047.66-.08 1-.08zm-4.184
      1.401l-1.472-1.473-1.415 1.415 1.473 1.473c.402-.537.878-1.013
      1.414-1.415zm9.782 1.414l1.473-1.473-1.414-1.414-1.473 1.473c.537.402
      1.012.878 1.414 1.414zm-5.598 11.185c-.34
      0-.672-.033-1-.08v2.08h2v-2.08c-.328.047-.66.08-1 .08zm4.185-1.402l1.473
      1.473 1.415-1.415-1.473-1.472c-.403.536-.879 1.012-1.415
      1.414zm-11.185-5.598c0-.34.033-.672.08-1h-2.08v2h2.08c-.047-.328-.08-.66-.08-1zm13.92-1c.047.328.08.66.08
      1s-.033.672-.08 1h2.08v-2h-2.08zm-12.519 5.184l-1.473 1.473 1.414 1.414
      1.473-1.473c-.536-.402-1.012-.877-1.414-1.414z"></path></svg> <svg class=w-5 viewBox="0 0 24 24" transform=rotate(-40)><path class=fill-pink d="M12 10.999c1.437.438 2.562 1.564 2.999 3.001.44-1.437 1.565-2.562
      3.001-3-1.436-.439-2.561-1.563-3.001-3-.437 1.436-1.562 2.561-2.999
      2.999zm8.001.001c.958.293 1.707 1.042 2 2.001.291-.959 1.042-1.709
      1.999-2.001-.957-.292-1.707-1.042-2-2-.293.958-1.042 1.708-1.999
      2zm-1-9c-.437 1.437-1.563 2.562-2.998 3.001 1.438.44 2.561 1.564 3.001
      3.002.437-1.438 1.563-2.563
      2.996-3.002-1.433-.437-2.559-1.564-2.999-3.001zm-7.001 22c-6.617
      0-12-5.383-12-12s5.383-12 12-12c1.894 0 3.63.497 5.37 1.179-2.948.504-9.37
      3.266-9.37 10.821 0 7.454 5.917 10.208 9.37 10.821-1.5.846-3.476
      1.179-5.37 1.179z"></path></svg></div> <div class="w-full flex-col justify-center md:w-5/12 pt-4 relative transition-padding"><a href=.><h1 class="font-display font-bold inline-block text-4xl whitespace-no-wrap">chuva <span class="-ml-5 text-red">.dev</span></h1></a></div> <nav class="flex pb-2 transition-padding border-b flex-wrap justify-between mt-4 w-full"><ul class="flex pb-2 transition-padding font-display list-none text-sm"><li class=mr-6><a href=blog class=hover:text-red rel=prefetch>Blog</a></li> <li class=mr-6><a href=blog/categories class=hover:text-red rel=prefetch>Categories </a></li> <li class=mr-6><a href=blog/hello-world class=hover:text-red rel=prefetch>About</a></ul> <ul class="flex pb-2 transition-padding font-display list-none text-sm"><li class=mr-6><a href=https://github.com/chuvikovd/ class=hover:text-red target=_blank>Github </a></li> <li><a href=https://www.linkedin.com/in/chuvikovd/ class=hover:text-red target=_blank>LinkedIn </a></ul></nav> <article class="w-full first:mt-0 mt-8"><h4 class="font-display font-bold"><a href=blog/categories/React-Static class=hover:text-red rel=prefetch>React-Static </a></h4> <h2 class="font-display font-bold leading-tight mb-1 md:text-4xl text-3xl">React-Static using node.api.js with 3rd party plugins</h2> <h5 class="font-display font-light">January 24, 2020, 1 min read</h5> </article> <div class="w-full markdown mt-6"><p>Today I faced an issue, using <code>React-Static</code>. Issue is clearly described <a href=https://github.com/react-static/react-static/issues/1328 class=link rel=nofollow target=_blank>here</a>.</p> <blockquote> <p>TLDR: Images in production build have wrong paths and are not loaded</p> </blockquote> <p>In the issue, <a href=https://github.com/martonkaufmann class=link rel=nofollow target=_blank>martnokaufmann</a> provided solution - modifying default <code>file-loader</code> inside <code>node.api.js</code>.</p> <p>For me this didn't worked, however. After some research I discovered that provided solution work only for <code>React-Static</code> without plugins, that modify <code>Webpack</code> loader configuration.</p> <h3 id=solution>Solution</h3> <p>If you are using plugins that modify <code>Webpack</code> loader configuration, for example <a href=https://www.npmjs.com/package/react-static-plugin-svg class=link rel=nofollow target=_blank>react-static-plugin-svg</a>, you must do some additional work inside <code>node.api.js</code>. This is required because plugins are loaded before loading <code>node.api.js</code>, so, there, we need to preserve plugin provided configuration also.</p> <p>For me the solution looks like this:</p> <pre><code class="hljs language-javascript"><span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> pluginOptions => ({
  <span class=hljs-attr>webpack</span>: <span class=hljs-function>(<span class=hljs-params>config, { defaultLoaders }</span>) =></span> {
    <span class=hljs-keyword>const</span> svgLoader = config.module.rules[<span class=hljs-number>0</span>].oneOf[<span class=hljs-number>0</span>]

    config.module.rules = [
      {
        <span class=hljs-attr>oneOf</span>: [
          svgLoader,
          defaultLoaders.jsLoader,
          defaultLoaders.jsLoaderExt,
          defaultLoaders.cssLoader,
          {
            <span class=hljs-attr>loader</span>: <span class=hljs-string>'url-loader'</span>,
            <span class=hljs-attr>test</span>: <span class=hljs-regexp>/\.(jpg|png)$/</span>,
            <span class=hljs-attr>query</span>: {
              <span class=hljs-attr>limit</span>: <span class=hljs-number>100</span>,
              <span class=hljs-attr>name</span>: <span class=hljs-string>'static/[name].[hash:8].[ext]'</span>,
            },
          },
          state.defaultLoaders.fileLoader,
        ],
      },
    ]
    <span class=hljs-keyword>return</span> config
  },
})</code></pre><p>For you, the setup might be different. Main idea is that we need to save all plugin added rules (in my case <code>const svgLoader = config.module.rules[0].oneOf[0]</code>), before modifying <code>rules.oneOf</code> array and apply them there also.</p> </div> <div class="flex border-t flex-col justify-between pt-8 sm:flex-row text-center w-full"><span>© 2020 Dmitrijs Čuvikovs</span> <span>Powered by <a href=https://svelte.dev/ class=link target=_blank>Svelte</a>, icons by <a href=https://iconmonstr.com class=link target=_blank>iconmonstr</a></span></div></div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"React-Static using node.api.js with 3rd party plugins",description:"How to work with node.api.js file inside React-Static while using third party plugins that modify webpack loaders",slug:"react-static-node-api-with-plugins",html:"\u003Cp\u003EToday I faced an issue, using \u003Ccode\u003EReact-Static\u003C\u002Fcode\u003E. Issue is clearly described \u003Ca target=\"_blank\" rel=\"nofollow\" class=\"link\" href=\"https:\u002F\u002Fgithub.com\u002Freact-static\u002Freact-static\u002Fissues\u002F1328\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003ETLDR: Images in production build have wrong paths and are not loaded\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003EIn the issue, \u003Ca target=\"_blank\" rel=\"nofollow\" class=\"link\" href=\"https:\u002F\u002Fgithub.com\u002Fmartonkaufmann\"\u003Emartnokaufmann\u003C\u002Fa\u003E provided solution - modifying default \u003Ccode\u003Efile-loader\u003C\u002Fcode\u003E inside \u003Ccode\u003Enode.api.js\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EFor me this didn&#39;t worked, however. After some research I discovered that provided solution work only for \u003Ccode\u003EReact-Static\u003C\u002Fcode\u003E without plugins, that modify \u003Ccode\u003EWebpack\u003C\u002Fcode\u003E loader configuration.\u003C\u002Fp\u003E\n\u003Ch3 id=\"solution\"\u003ESolution\u003C\u002Fh3\u003E\n\u003Cp\u003EIf you are using plugins that modify \u003Ccode\u003EWebpack\u003C\u002Fcode\u003E loader configuration, for example \u003Ca target=\"_blank\" rel=\"nofollow\" class=\"link\" href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Freact-static-plugin-svg\"\u003Ereact-static-plugin-svg\u003C\u002Fa\u003E, you must do some additional work inside \u003Ccode\u003Enode.api.js\u003C\u002Fcode\u003E. This is required because plugins are loaded before loading \u003Ccode\u003Enode.api.js\u003C\u002Fcode\u003E, so, there, we need to preserve plugin provided configuration also.\u003C\u002Fp\u003E\n\u003Cp\u003EFor me the solution looks like this:\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-javascript\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E pluginOptions =&gt; ({\n  \u003Cspan class=\"hljs-attr\"\u003Ewebpack\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Econfig, { defaultLoaders }\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E svgLoader = config.module.rules[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E].oneOf[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E]\n\n    config.module.rules = [\n      {\n        \u003Cspan class=\"hljs-attr\"\u003EoneOf\u003C\u002Fspan\u003E: [\n          svgLoader,\n          defaultLoaders.jsLoader,\n          defaultLoaders.jsLoaderExt,\n          defaultLoaders.cssLoader,\n          {\n            \u003Cspan class=\"hljs-attr\"\u003Eloader\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E'url-loader'\u003C\u002Fspan\u003E,\n            \u003Cspan class=\"hljs-attr\"\u003Etest\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-regexp\"\u003E\u002F\\.(jpg|png)$\u002F\u003C\u002Fspan\u003E,\n            \u003Cspan class=\"hljs-attr\"\u003Equery\u003C\u002Fspan\u003E: {\n              \u003Cspan class=\"hljs-attr\"\u003Elimit\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E100\u003C\u002Fspan\u003E,\n              \u003Cspan class=\"hljs-attr\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E'static\u002F[name].[hash:8].[ext]'\u003C\u002Fspan\u003E,\n            },\n          },\n          state.defaultLoaders.fileLoader,\n        ],\n      },\n    ]\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E config\n  },\n})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EFor you, the setup might be different. Main idea is that we need to save all plugin added rules (in my case \u003Ccode\u003Econst svgLoader = config.module.rules[0].oneOf[0]\u003C\u002Fcode\u003E), before modifying \u003Ccode\u003Erules.oneOf\u003C\u002Fcode\u003E array and apply them there also.\u003C\u002Fp\u003E\n",created:"2020-01-24T18:08:18.789Z",excerpt:"\u003Cp\u003EToday I faced an issue, using \u003Ccode\u003EReact-Static\u003C\u002Fcode\u003E. Issue is clearly described \u003Ca target=\"_blank\" rel=\"nofollow\" class=\"link\" href=\"https:\u002F\u002Fgithub.com\u002Freact-static\u002Freact-static\u002Fissues\u002F1328\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003ETLDR: Images in production build have wrong paths and are not loaded\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",categories:["React-Static"],time:"1 min read"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.52df29f7.js"}catch(e){main="/client/legacy/client.81f37c3d.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 